{% extends 'base.html.twig' %}



{% block title %}{% endblock %}



{% block body %}


<div id="chattest">

    {{ form_start(formChat) }}


    {{ form_row(formChat.message, {'attr': {'placeholder': "Contenue de l'article"}
    }) }}

    <div id="messageChatLaunch"> 
{{ form_widget(formChat.message) }}
    </div>


    <input type="submit" value="Valider" class="ajax" />

    {{ form_end(formChat) }}
</div>
  
    <div id="minichat" class="center">

                <h1>Bienvenue Ã  vous sur le chat de mon site personnel</h1>
{{ramdom }} 

    {% for message in messages %}
    
                <div id="messagechat" style="padding-left : 20px">
            {{ message.pseudo}} dit : {{ message.message }} le {{ message.createdAt| date('H:i')  }} 
         <img src="avatar/{{message.user.avatar }}"> 
                </div>

    {% endfor %}
        
                </div>
        </div>
{% endblock %}

{% block javascripts %}
 <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>

      

  let form =   document.getElementById('chattest');
        form.addEventListener('submit',onClickBtnLike );
        

        function testtroll(){

        }
   getMessages();
   function getMessages(){
       console.log("ok");
  const requeteAjax2 = new XMLHttpRequest();
  requeteAjax2.open('GET', '/chatajax');

        requeteAjax2.onload = function(){ 
            //let test = requeteAjax2.responseText;
            //console.log(test);
           
           const resultat = JSON.parse(requeteAjax2.responseText);

             console.log(resultat); 
      console.log(resultat.message);
document.getElementById("minichat").innerHTML = resultat.message;
             //console.log("test");
        }
       requeteAjax2.send();
   }
    


    function onClickBtnLike(event){
      
     event.preventDefault();
const messageChatLaunch = document.querySelector('#form_message');
        const data = new FormData();
        data.append('form_message', form_message.value);

         const requeteAjax = new XMLHttpRequest();
        
        requeteAjax.open('POST', '/chat/post', true);


  
        requeteAjax.send(data);
        
        getMessages();
  }


  

    </script>
{% endblock %}
